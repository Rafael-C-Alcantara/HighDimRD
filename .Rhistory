Q       <- matrix(K^2/n^2,ncol=K,nrow=K) # Transition matrix
diag(Q) <- 2*log(n/K)/(n/K)
## Initial Block assignments and change intensity
vertex_labels <- matrix(0,nrow=n,ncol=2)
vertex_labels[,1] <- sample(1:K,n,replace=TRUE)
vertex_labels[,2] <- rexp(n,rate=5)
## Phyisical positions of vertices
pos <- cbind(rnorm(n),rnorm(n))
D <- dist(pos)
D
## Set Up
n <- 10 # Network size
## Phyisical positions of vertices
pos <- cbind(rnorm(n),rnorm(n))
D <- dist(pos)
D
dim(D)
?dist
D <- dist(pos,diag=TRUE)
D
dimD()
dim(D)
D$Upper
t(D)
D+t(D)
attr(D,"upper")
attr(D,"Upper")
D <- dist(pos,diag=TRUE,upper=TRUE)
D
typeof(D)
dim(D)
D[1,1]
D[1]
D[2]
D[3]
as.matrix(D)
D <- as.matrix(dist(pos,diag=TRUE,upper=TRUE)=
D <- as.matrix(dist(pos,diag=TRUE,upper=TRUE))
dim(D)
library(devtools)
install.packages("devtools")
library(devtools)
install_github("jason-morgan/ina")
library(ina)
library(ergm)
mod1 <- ergm(Net~edges+mutual+ostar(2:3)+transitivities+edgecov("reportsto")+nodeicov("Tenure")+nodeocov("Tenure")+adsdiff("Tenure")+nodeicov("Age")+nodeocov("Age")+absdiff("Age"),control=control.ergm(MCMC.samplesize=5000,MCMC.burnin=10000,MCMLE.maxit=10),verbose=TRUE)
data("Krackhardt")
Net <- Krackhardt
set.seed(510)
mod1 <- ergm(Net~edges+mutual+ostar(2:3)+transitivities+edgecov("reportsto")+nodeicov("Tenure")+nodeocov("Tenure")+adsdiff("Tenure")+nodeicov("Age")+nodeocov("Age")+absdiff("Age"),control=control.ergm(MCMC.samplesize=5000,MCMC.burnin=10000,MCMLE.maxit=10),verbose=TRUE)
set.seed(510)
mod1 <- ergm(Net~edges+mutual+ostar(2:3)+transitiveties+edgecov("reportsto")+nodeicov("Tenure")+nodeocov("Tenure")+adsdiff("Tenure")+nodeicov("Age")+nodeocov("Age")+absdiff("Age"),control=control.ergm(MCMC.samplesize=5000,MCMC.burnin=10000,MCMLE.maxit=10),verbose=TRUE)
set.seed(510)
mod1 <- ergm(Net~edges+mutual+ostar(2:3)+transitiveties+edgecov("reportsto")+nodeicov("Tenure")+nodeocov("Tenure")+absdiff("Tenure")+nodeicov("Age")+nodeocov("Age")+absdiff("Age"),control=control.ergm(MCMC.samplesize=5000,MCMC.burnin=10000,MCMLE.maxit=10),verbose=TRUE)
gof1 <- gof(mod1)
gof1
plot(gof1)
dev.new()
par(mfrow=c(2,2))
plot(gof1)
summary(mod1)
mod0 <- ergm(Net~edges+nodematch("Level"),control=control.ergm(MCMC.samplesize=5000,MCMC.burnin=10000,MCMLE.maxit=10),verbose=TRUE)
summary(mod0)
library(xergm)
install.packages("xergm.common")
library(xergm)
library(xergm.common)
interpret(mod0,type="dyad",i=1,j=2)
load("C:/Users/MAST/Uni/Artikel/BaselineEstimation/R/Simulation/simulation_data.RData")
parameter$alpha_weekends
sqrt(0.05/5000)
sqrt(0.05^2/5000)
2*sqrt(0.05^2/5000)
2*sqrt(0.03^2/5000)
0.057/0.053
0.037/0.033
0.030/0.027
0.033/0.028
0.032/0.027
0.032/0.023
2*sqrt(8.23^2/5000)
load("C:/Users/MAST/Uni/Artikel/RD mit LASSO/R/PublishableCode/complete_simulation2.RData")
## Save Estimates
tau <- 0.02
estimate_LMS_CV <- rep(0,N)
estimate_LMS_LV <- rep(0,N)
estimate_LMS_BCH <- rep(0,N)
estimate_NC <- rep(0,N)
estimate_TC <- rep(0,N)
estimate_BC <- rep(0,N)
estimate_Z10 <- rep(0,N)
estimate_Z30 <- rep(0,N)
estimate_Z50 <- rep(0,N)
estimate_LMS_CV_bc <- rep(0,N)
estimate_LMS_LV_bc <- rep(0,N)
estimate_LMS_BCH_bc <- rep(0,N)
estimate_NC_bc <- rep(0,N)
estimate_TC_bc <- rep(0,N)
estimate_BC_bc <- rep(0,N)
estimate_sd_LMS_CV <- rep(0,N)
estimate_sd_LMS_LV <- rep(0,N)
estimate_sd_LMS_BCH <- rep(0,N)
estimate_sd_NC <- rep(0,N)
estimate_sd_TC <- rep(0,N)
estimate_sd_BC <- rep(0,N)
estimate_sd_Z10 <- rep(0,N)
estimate_sd_Z30 <- rep(0,N)
estimate_sd_Z50 <- rep(0,N)
estimate_sd_LMS_BCH_bc <- rep(0,N)
confidence_LMS_CV <- matrix(0,ncol=4,nrow=N)
confidence_LMS_LV <- matrix(0,ncol=4,nrow=N)
confidence_LMS_BCH <- matrix(0,ncol=4,nrow=N)
confidence_NC <- matrix(0,ncol=4,nrow=N)
confidence_TC <- matrix(0,ncol=4,nrow=N)
confidence_BC <- matrix(0,ncol=4,nrow=N)
zpars_LMS_CV  <- matrix(0,ncol=p,nrow=N)
zpars_LMS_LV  <- matrix(0,ncol=p,nrow=N)
zpars_LMS_BCH <- matrix(0,ncol=p,nrow=N)
npars_LMS_CV <- rep(0,N)
npars_LMS_LV <- rep(0,N)
npars_LMS_BCH <- rep(0,N)
h_LMS_BCH <- rep(0,N)
h_NC <- rep(0,N)
for(i in 1:N) {
estimate_LMS_CV[i]  <- out[[i]][[1]]$rd$coef[1]
estimate_LMS_LV[i]  <- out[[i]][[2]]$rd$coef[1]
estimate_LMS_BCH[i] <- out[[i]][[3]]$rd$coef[1]
estimate_NC[i]      <- out[[i]][[4]]$coef[1]
estimate_TC[i]      <- out[[i]][[5]]$coef[1]
estimate_BC[i]      <- out[[i]][[6]]$coef[1]
estimate_Z10[i] <- out[[i]][[7]]$coef[1]
estimate_Z30[i] <- out[[i]][[8]]$coef[1]
estimate_Z50[i] <- out[[i]][[9]]$coef[1]
estimate_LMS_CV_bc[i]  <- out[[i]][[1]]$rd$coef[2]
estimate_LMS_LV_bc[i]  <- out[[i]][[2]]$rd$coef[2]
estimate_LMS_BCH_bc[i] <- out[[i]][[3]]$rd$coef[2]
estimate_NC_bc[i]      <- out[[i]][[4]]$coef[2]
estimate_TC_bc[i]      <- out[[i]][[5]]$coef[2]
estimate_BC_bc[i]      <- out[[i]][[6]]$coef[2]
estimate_sd_LMS_CV[i]  <- out[[i]][[1]]$rd$se[1]
estimate_sd_LMS_LV[i]  <- out[[i]][[2]]$rd$se[1]
estimate_sd_LMS_BCH[i] <- out[[i]][[3]]$rd$se[1]
estimate_sd_NC[i]      <- out[[i]][[4]]$se[1]
estimate_sd_TC[i]      <- out[[i]][[5]]$se[1]
estimate_sd_BC[i]      <- out[[i]][[6]]$se[1]
estimate_sd_LMS_BCH_bc[i] <- out[[i]][[2]]$rd$se[3]
estimate_sd_Z10[i] <- out[[i]][[7]]$se[1]
estimate_sd_Z30[i] <- out[[i]][[8]]$se[1]
estimate_sd_Z50[i] <- out[[i]][[9]]$se[1]
confidence_LMS_CV[i,]  <- c(out[[i]][[1]]$rd$ci[3,],out[[i]][[1]]$rd$ci[3,2]-out[[i]][[1]]$rd$ci[3,1],as.numeric(tau>=out[[i]][[1]]$rd$ci[3,1] & tau<=out[[i]][[1]]$rd$ci[3,2]))
confidence_LMS_LV[i,]  <- c(out[[i]][[2]]$rd$ci[3,],out[[i]][[2]]$rd$ci[3,2]-out[[i]][[2]]$rd$ci[3,1],as.numeric(tau>=out[[i]][[2]]$rd$ci[3,1] & tau<=out[[i]][[2]]$rd$ci[3,2]))
confidence_LMS_BCH[i,] <- c(out[[i]][[3]]$rd$ci[3,],out[[i]][[3]]$rd$ci[3,2]-out[[i]][[3]]$rd$ci[3,1],as.numeric(tau>=out[[i]][[3]]$rd$ci[3,1] & tau<=out[[i]][[3]]$rd$ci[3,2]))
confidence_NC[i,]      <- c(out[[i]][[4]]$ci[3,]   ,out[[i]][[4]]$ci[3,2]   -out[[i]][[4]]$ci[3,1]   ,as.numeric(tau>=out[[i]][[4]]$ci[3,1]    & tau<=out[[i]][[4]]$ci[3,2]))
confidence_TC[i,]      <- c(out[[i]][[5]]$ci[3,]   ,out[[i]][[5]]$ci[3,2]   -out[[i]][[5]]$ci[3,1]   ,as.numeric(tau>=out[[i]][[5]]$ci[3,1]    & tau<=out[[i]][[5]]$ci[3,2]))
confidence_BC[i,]      <- c(out[[i]][[6]]$ci[3,]   ,out[[i]][[6]]$ci[3,2]   -out[[i]][[6]]$ci[3,1]   ,as.numeric(tau>=out[[i]][[6]]$ci[3,1]    & tau<=out[[i]][[6]]$ci[3,2]))
zpars_LMS_CV[i,]  <- out[[i]][[1]]$Zpars
zpars_LMS_LV[i,]  <- out[[i]][[2]]$Zpars
zpars_LMS_BCH[i,] <- out[[i]][[3]]$Zpars
npars_LMS_CV[i]  <- sum(zpars_LMS_CV[i,] !=0)
npars_LMS_LV[i]  <- sum(zpars_LMS_LV[i,] !=0)
npars_LMS_BCH[i] <- sum(zpars_LMS_BCH[i,]!=0)
h_LMS_BCH[i] <- out[[i]][[3]]$rd$bws[1,1]
h_NC[i] <- out[[i]][[4]]$bws[1,1]
}
## Compute Average Parameter Values
avg_cov_LMS_CV  <- rep(0,p)
avg_cov_LMS_LV  <- rep(0,p)
avg_cov_LMS_BCH <- rep(0,p)
for(k in 1:p) {
ind <- which(zpars_LMS_CV[,k]!=0)
avg_cov_LMS_CV[k]  <- mean(zpars_LMS_CV[ind,k])
ind <- which(zpars_LMS_LV[,k]!=0)
avg_cov_LMS_LV[k]  <- mean(zpars_LMS_LV[ind,k])
ind <- which(zpars_LMS_BCH[,k]!=0)
avg_cov_LMS_BCH[k] <- mean(zpars_LMS_BCH[ind,k])
}
## Print Biases, standard error in brackets
cat("Bias of LMS_CV=" ,mean(estimate_LMS_CV) -tau,"(",sd(estimate_LMS_CV) ,").\n")
cat("Bias of LMS_LV=" ,mean(estimate_LMS_LV) -tau,"(",sd(estimate_LMS_LV) ,").\n")
cat("Bias of LMS_BCH=",mean(estimate_LMS_BCH)-tau,"(",sd(estimate_LMS_BCH),").\n")
cat("Bias of NC="     ,mean(estimate_NC)-tau,"(",sd(estimate_NC),").\n")
cat("Bias of TC="     ,mean(estimate_TC)-tau,"(",sd(estimate_TC),").\n")
cat("Bias of BC="     ,mean(estimate_BC)-tau,"(",sd(estimate_BC),").\n")
## Estimated Standard Errors (standard error in brackets)
cat("Estimated sd of LMS_CV= ",mean(estimate_sd_LMS_CV )," (",sd(estimate_sd_LMS_CV ),")\n")
cat("Coverage of LMS_CV =",sum(confidence_LMS_CV[,4])/N*100 ,"%.\n")
cat("Coverage of LMS_LV =",sum(confidence_LMS_LV[,4])/N*100 ,"%.\n")
cat("Coverage of LMS_BCH=",sum(confidence_LMS_BCH[,4])/N*100,"%.\n")
cat("Coverage of NC=",sum(confidence_NC[,4])/N*100,"%.\n")
cat("Coverage of TC=",sum(confidence_TC[,4])/N*100,"%.\n")
cat("Coverage of BC=",sum(confidence_BC[,4])/N*100,"%.\n")
load("C:/Users/MAST/Uni/Artikel/RD mit LASSO/R/PublishableCode/complete_simulation_Z.RData")
## Save Estimates
tau <- 0.02
estimate_LMS_CV <- rep(0,N)
estimate_LMS_LV <- rep(0,N)
estimate_LMS_BCH <- rep(0,N)
estimate_NC <- rep(0,N)
estimate_TC <- rep(0,N)
estimate_BC <- rep(0,N)
estimate_Z10 <- rep(0,N)
estimate_Z30 <- rep(0,N)
estimate_Z50 <- rep(0,N)
estimate_LMS_CV_bc <- rep(0,N)
estimate_LMS_LV_bc <- rep(0,N)
estimate_LMS_BCH_bc <- rep(0,N)
estimate_NC_bc <- rep(0,N)
estimate_TC_bc <- rep(0,N)
estimate_BC_bc <- rep(0,N)
estimate_sd_LMS_CV <- rep(0,N)
estimate_sd_LMS_LV <- rep(0,N)
estimate_sd_LMS_BCH <- rep(0,N)
estimate_sd_NC <- rep(0,N)
estimate_sd_TC <- rep(0,N)
estimate_sd_BC <- rep(0,N)
estimate_sd_Z10 <- rep(0,N)
estimate_sd_Z30 <- rep(0,N)
estimate_sd_Z50 <- rep(0,N)
estimate_sd_LMS_BCH_bc <- rep(0,N)
confidence_LMS_CV <- matrix(0,ncol=4,nrow=N)
confidence_LMS_LV <- matrix(0,ncol=4,nrow=N)
confidence_LMS_BCH <- matrix(0,ncol=4,nrow=N)
confidence_NC <- matrix(0,ncol=4,nrow=N)
confidence_TC <- matrix(0,ncol=4,nrow=N)
confidence_BC <- matrix(0,ncol=4,nrow=N)
zpars_LMS_CV  <- matrix(0,ncol=p,nrow=N)
zpars_LMS_LV  <- matrix(0,ncol=p,nrow=N)
zpars_LMS_BCH <- matrix(0,ncol=p,nrow=N)
npars_LMS_CV <- rep(0,N)
npars_LMS_LV <- rep(0,N)
npars_LMS_BCH <- rep(0,N)
h_LMS_BCH <- rep(0,N)
h_NC <- rep(0,N)
for(i in 1:N) {
estimate_LMS_CV[i]  <- out[[i]][[1]]$rd$coef[1]
estimate_LMS_LV[i]  <- out[[i]][[2]]$rd$coef[1]
estimate_LMS_BCH[i] <- out[[i]][[3]]$rd$coef[1]
estimate_NC[i]      <- out[[i]][[4]]$coef[1]
estimate_TC[i]      <- out[[i]][[5]]$coef[1]
estimate_BC[i]      <- out[[i]][[6]]$coef[1]
estimate_Z10[i] <- out[[i]][[7]]$coef[1]
estimate_Z30[i] <- out[[i]][[8]]$coef[1]
estimate_Z50[i] <- out[[i]][[9]]$coef[1]
estimate_LMS_CV_bc[i]  <- out[[i]][[1]]$rd$coef[2]
estimate_LMS_LV_bc[i]  <- out[[i]][[2]]$rd$coef[2]
estimate_LMS_BCH_bc[i] <- out[[i]][[3]]$rd$coef[2]
estimate_NC_bc[i]      <- out[[i]][[4]]$coef[2]
estimate_TC_bc[i]      <- out[[i]][[5]]$coef[2]
estimate_BC_bc[i]      <- out[[i]][[6]]$coef[2]
estimate_sd_LMS_CV[i]  <- out[[i]][[1]]$rd$se[1]
estimate_sd_LMS_LV[i]  <- out[[i]][[2]]$rd$se[1]
estimate_sd_LMS_BCH[i] <- out[[i]][[3]]$rd$se[1]
estimate_sd_NC[i]      <- out[[i]][[4]]$se[1]
estimate_sd_TC[i]      <- out[[i]][[5]]$se[1]
estimate_sd_BC[i]      <- out[[i]][[6]]$se[1]
estimate_sd_LMS_BCH_bc[i] <- out[[i]][[2]]$rd$se[3]
estimate_sd_Z10[i] <- out[[i]][[7]]$se[1]
estimate_sd_Z30[i] <- out[[i]][[8]]$se[1]
estimate_sd_Z50[i] <- out[[i]][[9]]$se[1]
confidence_LMS_CV[i,]  <- c(out[[i]][[1]]$rd$ci[3,],out[[i]][[1]]$rd$ci[3,2]-out[[i]][[1]]$rd$ci[3,1],as.numeric(tau>=out[[i]][[1]]$rd$ci[3,1] & tau<=out[[i]][[1]]$rd$ci[3,2]))
confidence_LMS_LV[i,]  <- c(out[[i]][[2]]$rd$ci[3,],out[[i]][[2]]$rd$ci[3,2]-out[[i]][[2]]$rd$ci[3,1],as.numeric(tau>=out[[i]][[2]]$rd$ci[3,1] & tau<=out[[i]][[2]]$rd$ci[3,2]))
confidence_LMS_BCH[i,] <- c(out[[i]][[3]]$rd$ci[3,],out[[i]][[3]]$rd$ci[3,2]-out[[i]][[3]]$rd$ci[3,1],as.numeric(tau>=out[[i]][[3]]$rd$ci[3,1] & tau<=out[[i]][[3]]$rd$ci[3,2]))
confidence_NC[i,]      <- c(out[[i]][[4]]$ci[3,]   ,out[[i]][[4]]$ci[3,2]   -out[[i]][[4]]$ci[3,1]   ,as.numeric(tau>=out[[i]][[4]]$ci[3,1]    & tau<=out[[i]][[4]]$ci[3,2]))
confidence_TC[i,]      <- c(out[[i]][[5]]$ci[3,]   ,out[[i]][[5]]$ci[3,2]   -out[[i]][[5]]$ci[3,1]   ,as.numeric(tau>=out[[i]][[5]]$ci[3,1]    & tau<=out[[i]][[5]]$ci[3,2]))
confidence_BC[i,]      <- c(out[[i]][[6]]$ci[3,]   ,out[[i]][[6]]$ci[3,2]   -out[[i]][[6]]$ci[3,1]   ,as.numeric(tau>=out[[i]][[6]]$ci[3,1]    & tau<=out[[i]][[6]]$ci[3,2]))
zpars_LMS_CV[i,]  <- out[[i]][[1]]$Zpars
zpars_LMS_LV[i,]  <- out[[i]][[2]]$Zpars
zpars_LMS_BCH[i,] <- out[[i]][[3]]$Zpars
npars_LMS_CV[i]  <- sum(zpars_LMS_CV[i,] !=0)
npars_LMS_LV[i]  <- sum(zpars_LMS_LV[i,] !=0)
npars_LMS_BCH[i] <- sum(zpars_LMS_BCH[i,]!=0)
h_LMS_BCH[i] <- out[[i]][[3]]$rd$bws[1,1]
h_NC[i] <- out[[i]][[4]]$bws[1,1]
}
for(i in 1:N) {
#  estimate_LMS_CV[i]  <- out[[i]][[1]]$rd$coef[1]
#  estimate_LMS_LV[i]  <- out[[i]][[2]]$rd$coef[1]
#  estimate_LMS_BCH[i] <- out[[i]][[3]]$rd$coef[1]
#  estimate_NC[i]      <- out[[i]][[4]]$coef[1]
#  estimate_TC[i]      <- out[[i]][[5]]$coef[1]
#  estimate_BC[i]      <- out[[i]][[6]]$coef[1]
estimate_Z10[i] <- out[[i]][[7]]$coef[1]
estimate_Z30[i] <- out[[i]][[8]]$coef[1]
estimate_Z50[i] <- out[[i]][[9]]$coef[1]
#  estimate_LMS_CV_bc[i]  <- out[[i]][[1]]$rd$coef[2]
#  estimate_LMS_LV_bc[i]  <- out[[i]][[2]]$rd$coef[2]
#  estimate_LMS_BCH_bc[i] <- out[[i]][[3]]$rd$coef[2]
#  estimate_NC_bc[i]      <- out[[i]][[4]]$coef[2]
#  estimate_TC_bc[i]      <- out[[i]][[5]]$coef[2]
#  estimate_BC_bc[i]      <- out[[i]][[6]]$coef[2]
#  estimate_sd_LMS_CV[i]  <- out[[i]][[1]]$rd$se[1]
#  estimate_sd_LMS_LV[i]  <- out[[i]][[2]]$rd$se[1]
#  estimate_sd_LMS_BCH[i] <- out[[i]][[3]]$rd$se[1]
#  estimate_sd_NC[i]      <- out[[i]][[4]]$se[1]
#  estimate_sd_TC[i]      <- out[[i]][[5]]$se[1]
#  estimate_sd_BC[i]      <- out[[i]][[6]]$se[1]
#  estimate_sd_LMS_BCH_bc[i] <- out[[i]][[2]]$rd$se[3]
estimate_sd_Z10[i] <- out[[i]][[7]]$se[1]
estimate_sd_Z30[i] <- out[[i]][[8]]$se[1]
estimate_sd_Z50[i] <- out[[i]][[9]]$se[1]
#  confidence_LMS_CV[i,]  <- c(out[[i]][[1]]$rd$ci[3,],out[[i]][[1]]$rd$ci[3,2]-out[[i]][[1]]$rd$ci[3,1],as.numeric(tau>=out[[i]][[1]]$rd$ci[3,1] & tau<=out[[i]][[1]]$rd$ci[3,2]))
#  confidence_LMS_LV[i,]  <- c(out[[i]][[2]]$rd$ci[3,],out[[i]][[2]]$rd$ci[3,2]-out[[i]][[2]]$rd$ci[3,1],as.numeric(tau>=out[[i]][[2]]$rd$ci[3,1] & tau<=out[[i]][[2]]$rd$ci[3,2]))
#  confidence_LMS_BCH[i,] <- c(out[[i]][[3]]$rd$ci[3,],out[[i]][[3]]$rd$ci[3,2]-out[[i]][[3]]$rd$ci[3,1],as.numeric(tau>=out[[i]][[3]]$rd$ci[3,1] & tau<=out[[i]][[3]]$rd$ci[3,2]))
#  confidence_NC[i,]      <- c(out[[i]][[4]]$ci[3,]   ,out[[i]][[4]]$ci[3,2]   -out[[i]][[4]]$ci[3,1]   ,as.numeric(tau>=out[[i]][[4]]$ci[3,1]    & tau<=out[[i]][[4]]$ci[3,2]))
#  confidence_TC[i,]      <- c(out[[i]][[5]]$ci[3,]   ,out[[i]][[5]]$ci[3,2]   -out[[i]][[5]]$ci[3,1]   ,as.numeric(tau>=out[[i]][[5]]$ci[3,1]    & tau<=out[[i]][[5]]$ci[3,2]))
#  confidence_BC[i,]      <- c(out[[i]][[6]]$ci[3,]   ,out[[i]][[6]]$ci[3,2]   -out[[i]][[6]]$ci[3,1]   ,as.numeric(tau>=out[[i]][[6]]$ci[3,1]    & tau<=out[[i]][[6]]$ci[3,2]))
#  zpars_LMS_CV[i,]  <- out[[i]][[1]]$Zpars
#  zpars_LMS_LV[i,]  <- out[[i]][[2]]$Zpars
#  zpars_LMS_BCH[i,] <- out[[i]][[3]]$Zpars
#  npars_LMS_CV[i]  <- sum(zpars_LMS_CV[i,] !=0)
#  npars_LMS_LV[i]  <- sum(zpars_LMS_LV[i,] !=0)
#  npars_LMS_BCH[i] <- sum(zpars_LMS_BCH[i,]!=0)
#  h_LMS_BCH[i] <- out[[i]][[3]]$rd$bws[1,1]
#  h_NC[i] <- out[[i]][[4]]$bws[1,1]
}
## Behavior of the Zrds
cat("Choosing 10 covariates: Real SD=",sd(estimate_Z10),", estimated SD=",mean(estimate_sd_Z10),".\n")
cat("Choosing 30 covariates: Real SD=",sd(estimate_Z30),", estimated SD=",mean(estimate_sd_Z30),".\n")
cat("Choosing 50 covariates: Real SD=",sd(estimate_Z50),", estimated SD=",mean(estimate_sd_Z50),".\n")
mean(estimate_z30)-tau
mean(estimate_Z30)-tau
mean(estimate_Z10)-tau
mean(estimate_Z50)-tau
confidence_Z10 <- matrix(0,ncol=4,nrow=N)
confidence_Z30 <- matrix(0,ncol=4,nrow=N)
confidence_Z50 <- matrix(0,ncol=4,nrow=N)
for(i in 1:N) {
#  estimate_LMS_CV[i]  <- out[[i]][[1]]$rd$coef[1]
#  estimate_LMS_LV[i]  <- out[[i]][[2]]$rd$coef[1]
#  estimate_LMS_BCH[i] <- out[[i]][[3]]$rd$coef[1]
#  estimate_NC[i]      <- out[[i]][[4]]$coef[1]
#  estimate_TC[i]      <- out[[i]][[5]]$coef[1]
#  estimate_BC[i]      <- out[[i]][[6]]$coef[1]
estimate_Z10[i] <- out[[i]][[7]]$coef[1]
estimate_Z30[i] <- out[[i]][[8]]$coef[1]
estimate_Z50[i] <- out[[i]][[9]]$coef[1]
#  estimate_LMS_CV_bc[i]  <- out[[i]][[1]]$rd$coef[2]
#  estimate_LMS_LV_bc[i]  <- out[[i]][[2]]$rd$coef[2]
#  estimate_LMS_BCH_bc[i] <- out[[i]][[3]]$rd$coef[2]
#  estimate_NC_bc[i]      <- out[[i]][[4]]$coef[2]
#  estimate_TC_bc[i]      <- out[[i]][[5]]$coef[2]
#  estimate_BC_bc[i]      <- out[[i]][[6]]$coef[2]
#  estimate_sd_LMS_CV[i]  <- out[[i]][[1]]$rd$se[1]
#  estimate_sd_LMS_LV[i]  <- out[[i]][[2]]$rd$se[1]
#  estimate_sd_LMS_BCH[i] <- out[[i]][[3]]$rd$se[1]
#  estimate_sd_NC[i]      <- out[[i]][[4]]$se[1]
#  estimate_sd_TC[i]      <- out[[i]][[5]]$se[1]
#  estimate_sd_BC[i]      <- out[[i]][[6]]$se[1]
#  estimate_sd_LMS_BCH_bc[i] <- out[[i]][[2]]$rd$se[3]
estimate_sd_Z10[i] <- out[[i]][[7]]$se[1]
estimate_sd_Z30[i] <- out[[i]][[8]]$se[1]
estimate_sd_Z50[i] <- out[[i]][[9]]$se[1]
#  confidence_LMS_CV[i,]  <- c(out[[i]][[1]]$rd$ci[3,],out[[i]][[1]]$rd$ci[3,2]-out[[i]][[1]]$rd$ci[3,1],as.numeric(tau>=out[[i]][[1]]$rd$ci[3,1] & tau<=out[[i]][[1]]$rd$ci[3,2]))
#  confidence_LMS_LV[i,]  <- c(out[[i]][[2]]$rd$ci[3,],out[[i]][[2]]$rd$ci[3,2]-out[[i]][[2]]$rd$ci[3,1],as.numeric(tau>=out[[i]][[2]]$rd$ci[3,1] & tau<=out[[i]][[2]]$rd$ci[3,2]))
#  confidence_LMS_BCH[i,] <- c(out[[i]][[3]]$rd$ci[3,],out[[i]][[3]]$rd$ci[3,2]-out[[i]][[3]]$rd$ci[3,1],as.numeric(tau>=out[[i]][[3]]$rd$ci[3,1] & tau<=out[[i]][[3]]$rd$ci[3,2]))
#  confidence_NC[i,]      <- c(out[[i]][[4]]$ci[3,]   ,out[[i]][[4]]$ci[3,2]   -out[[i]][[4]]$ci[3,1]   ,as.numeric(tau>=out[[i]][[4]]$ci[3,1]    & tau<=out[[i]][[4]]$ci[3,2]))
#  confidence_TC[i,]      <- c(out[[i]][[5]]$ci[3,]   ,out[[i]][[5]]$ci[3,2]   -out[[i]][[5]]$ci[3,1]   ,as.numeric(tau>=out[[i]][[5]]$ci[3,1]    & tau<=out[[i]][[5]]$ci[3,2]))
#  confidence_BC[i,]      <- c(out[[i]][[6]]$ci[3,]   ,out[[i]][[6]]$ci[3,2]   -out[[i]][[6]]$ci[3,1]   ,as.numeric(tau>=out[[i]][[6]]$ci[3,1]    & tau<=out[[i]][[6]]$ci[3,2]))
confidence_Z10[i,]      <- c(out[[i]][[7]]$ci[3,]   ,out[[i]][[7]]$ci[3,2]   -out[[i]][[7]]$ci[3,1]   ,as.numeric(tau>=out[[i]][[7]]$ci[3,1]    & tau<=out[[i]][[7]]$ci[3,2]))
confidence_Z30[i,]      <- c(out[[i]][[8]]$ci[3,]   ,out[[i]][[8]]$ci[3,2]   -out[[i]][[8]]$ci[3,1]   ,as.numeric(tau>=out[[i]][[8]]$ci[3,1]    & tau<=out[[i]][[8]]$ci[3,2]))
confidence_Z50[i,]      <- c(out[[i]][[9]]$ci[3,]   ,out[[i]][[9]]$ci[3,2]   -out[[i]][[9]]$ci[3,1]   ,as.numeric(tau>=out[[i]][[9]]$ci[3,1]    & tau<=out[[i]][[9]]$ci[3,2]))
#  zpars_LMS_CV[i,]  <- out[[i]][[1]]$Zpars
#  zpars_LMS_LV[i,]  <- out[[i]][[2]]$Zpars
#  zpars_LMS_BCH[i,] <- out[[i]][[3]]$Zpars
#  npars_LMS_CV[i]  <- sum(zpars_LMS_CV[i,] !=0)
#  npars_LMS_LV[i]  <- sum(zpars_LMS_LV[i,] !=0)
#  npars_LMS_BCH[i] <- sum(zpars_LMS_BCH[i,]!=0)
#  h_LMS_BCH[i] <- out[[i]][[3]]$rd$bws[1,1]
#  h_NC[i] <- out[[i]][[4]]$bws[1,1]
}
cat("Coverage of Z10=",sum(confidence_Z10[,4])/N*100,"%.\n")
cat("Coverage of Z30=",sum(confidence_Z30[,4])/N*100,"%.\n")
cat("Coverage of Z50=",sum(confidence_Z50[,4])/N*100,"%.\n")
load("C:/Users/MAST/Uni/Artikel/RD mit LASSO/R/Application/Card Application/results_final.RData")
load("C:/Users/MAST/Uni/Artikel/RD mit LASSO/R/PublishableCode/complete_simulation_final_final.RData")
## Save Estimates
tau <- 0.02
estimate_LMS_CV <- rep(0,N)
estimate_LMS_LV <- rep(0,N)
estimate_LMS_BCH <- rep(0,N)
estimate_NC <- rep(0,N)
estimate_TC <- rep(0,N)
estimate_BC <- rep(0,N)
estimate_Z10 <- rep(0,N)
estimate_Z30 <- rep(0,N)
estimate_Z50 <- rep(0,N)
estimate_LMS_CV_bc <- rep(0,N)
estimate_LMS_LV_bc <- rep(0,N)
estimate_LMS_BCH_bc <- rep(0,N)
estimate_NC_bc <- rep(0,N)
estimate_TC_bc <- rep(0,N)
estimate_BC_bc <- rep(0,N)
estimate_sd_LMS_CV <- rep(0,N)
estimate_sd_LMS_LV <- rep(0,N)
estimate_sd_LMS_BCH <- rep(0,N)
estimate_sd_NC <- rep(0,N)
estimate_sd_TC <- rep(0,N)
estimate_sd_BC <- rep(0,N)
estimate_sd_Z10 <- rep(0,N)
estimate_sd_Z30 <- rep(0,N)
estimate_sd_Z50 <- rep(0,N)
estimate_sd_LMS_BCH_bc <- rep(0,N)
confidence_LMS_CV <- matrix(0,ncol=4,nrow=N)
confidence_LMS_LV <- matrix(0,ncol=4,nrow=N)
confidence_LMS_BCH <- matrix(0,ncol=4,nrow=N)
confidence_NC <- matrix(0,ncol=4,nrow=N)
confidence_TC <- matrix(0,ncol=4,nrow=N)
confidence_BC <- matrix(0,ncol=4,nrow=N)
confidence_Z10 <- matrix(0,ncol=4,nrow=N)
confidence_Z30 <- matrix(0,ncol=4,nrow=N)
confidence_Z50 <- matrix(0,ncol=4,nrow=N)
zpars_LMS_CV  <- matrix(0,ncol=p,nrow=N)
zpars_LMS_LV  <- matrix(0,ncol=p,nrow=N)
zpars_LMS_BCH <- matrix(0,ncol=p,nrow=N)
npars_LMS_CV <- rep(0,N)
npars_LMS_LV <- rep(0,N)
npars_LMS_BCH <- rep(0,N)
h_LMS_BCH <- rep(0,N)
h_NC <- rep(0,N)
for(i in 1:N) {
estimate_LMS_CV[i]  <- out[[i]][[1]]$rd$coef[1]
estimate_LMS_LV[i]  <- out[[i]][[2]]$rd$coef[1]
estimate_LMS_BCH[i] <- out[[i]][[3]]$rd$coef[1]
estimate_NC[i]      <- out[[i]][[4]]$coef[1]
estimate_TC[i]      <- out[[i]][[5]]$coef[1]
estimate_BC[i]      <- out[[i]][[6]]$coef[1]
estimate_Z10[i] <- out[[i]][[7]]$coef[1]
estimate_Z30[i] <- out[[i]][[8]]$coef[1]
estimate_Z50[i] <- out[[i]][[9]]$coef[1]
estimate_LMS_CV_bc[i]  <- out[[i]][[1]]$rd$coef[2]
estimate_LMS_LV_bc[i]  <- out[[i]][[2]]$rd$coef[2]
estimate_LMS_BCH_bc[i] <- out[[i]][[3]]$rd$coef[2]
estimate_NC_bc[i]      <- out[[i]][[4]]$coef[2]
estimate_TC_bc[i]      <- out[[i]][[5]]$coef[2]
estimate_BC_bc[i]      <- out[[i]][[6]]$coef[2]
estimate_sd_LMS_CV[i]  <- out[[i]][[1]]$rd$se[1]
estimate_sd_LMS_LV[i]  <- out[[i]][[2]]$rd$se[1]
estimate_sd_LMS_BCH[i] <- out[[i]][[3]]$rd$se[1]
estimate_sd_NC[i]      <- out[[i]][[4]]$se[1]
estimate_sd_TC[i]      <- out[[i]][[5]]$se[1]
estimate_sd_BC[i]      <- out[[i]][[6]]$se[1]
estimate_sd_LMS_BCH_bc[i] <- out[[i]][[2]]$rd$se[3]
estimate_sd_Z10[i] <- out[[i]][[7]]$se[1]
estimate_sd_Z30[i] <- out[[i]][[8]]$se[1]
estimate_sd_Z50[i] <- out[[i]][[9]]$se[1]
confidence_LMS_CV[i,]  <- c(out[[i]][[1]]$rd$ci[3,],out[[i]][[1]]$rd$ci[3,2]-out[[i]][[1]]$rd$ci[3,1],as.numeric(tau>=out[[i]][[1]]$rd$ci[3,1] & tau<=out[[i]][[1]]$rd$ci[3,2]))
confidence_LMS_LV[i,]  <- c(out[[i]][[2]]$rd$ci[3,],out[[i]][[2]]$rd$ci[3,2]-out[[i]][[2]]$rd$ci[3,1],as.numeric(tau>=out[[i]][[2]]$rd$ci[3,1] & tau<=out[[i]][[2]]$rd$ci[3,2]))
confidence_LMS_BCH[i,] <- c(out[[i]][[3]]$rd$ci[3,],out[[i]][[3]]$rd$ci[3,2]-out[[i]][[3]]$rd$ci[3,1],as.numeric(tau>=out[[i]][[3]]$rd$ci[3,1] & tau<=out[[i]][[3]]$rd$ci[3,2]))
confidence_NC[i,]      <- c(out[[i]][[4]]$ci[3,]   ,out[[i]][[4]]$ci[3,2]   -out[[i]][[4]]$ci[3,1]   ,as.numeric(tau>=out[[i]][[4]]$ci[3,1]    & tau<=out[[i]][[4]]$ci[3,2]))
confidence_TC[i,]      <- c(out[[i]][[5]]$ci[3,]   ,out[[i]][[5]]$ci[3,2]   -out[[i]][[5]]$ci[3,1]   ,as.numeric(tau>=out[[i]][[5]]$ci[3,1]    & tau<=out[[i]][[5]]$ci[3,2]))
confidence_BC[i,]      <- c(out[[i]][[6]]$ci[3,]   ,out[[i]][[6]]$ci[3,2]   -out[[i]][[6]]$ci[3,1]   ,as.numeric(tau>=out[[i]][[6]]$ci[3,1]    & tau<=out[[i]][[6]]$ci[3,2]))
confidence_Z10[i,]      <- c(out[[i]][[7]]$ci[3,]   ,out[[i]][[7]]$ci[3,2]   -out[[i]][[7]]$ci[3,1]   ,as.numeric(tau>=out[[i]][[7]]$ci[3,1]    & tau<=out[[i]][[7]]$ci[3,2]))
confidence_Z30[i,]      <- c(out[[i]][[8]]$ci[3,]   ,out[[i]][[8]]$ci[3,2]   -out[[i]][[8]]$ci[3,1]   ,as.numeric(tau>=out[[i]][[8]]$ci[3,1]    & tau<=out[[i]][[8]]$ci[3,2]))
confidence_Z50[i,]      <- c(out[[i]][[9]]$ci[3,]   ,out[[i]][[9]]$ci[3,2]   -out[[i]][[9]]$ci[3,1]   ,as.numeric(tau>=out[[i]][[9]]$ci[3,1]    & tau<=out[[i]][[9]]$ci[3,2]))
zpars_LMS_CV[i,]  <- out[[i]][[1]]$Zpars
zpars_LMS_LV[i,]  <- out[[i]][[2]]$Zpars
zpars_LMS_BCH[i,] <- out[[i]][[3]]$Zpars
npars_LMS_CV[i]  <- sum(zpars_LMS_CV[i,] !=0)
npars_LMS_LV[i]  <- sum(zpars_LMS_LV[i,] !=0)
npars_LMS_BCH[i] <- sum(zpars_LMS_BCH[i,]!=0)
h_LMS_BCH[i] <- out[[i]][[3]]$rd$bws[1,1]
h_NC[i] <- out[[i]][[4]]$bws[1,1]
}
## Compute Average Parameter Values
avg_cov_LMS_CV  <- rep(0,p)
avg_cov_LMS_LV  <- rep(0,p)
avg_cov_LMS_BCH <- rep(0,p)
for(k in 1:p) {
ind <- which(zpars_LMS_CV[,k]!=0)
avg_cov_LMS_CV[k]  <- mean(zpars_LMS_CV[ind,k])
ind <- which(zpars_LMS_LV[,k]!=0)
avg_cov_LMS_LV[k]  <- mean(zpars_LMS_LV[ind,k])
ind <- which(zpars_LMS_BCH[,k]!=0)
avg_cov_LMS_BCH[k] <- mean(zpars_LMS_BCH[ind,k])
}
dev.new()
par(las=1)
boxplot(estimate_LMS_CV,estimate_LMS_LV,estimate_LMS_BCH,estimate_BC,estimate_TC,estimate_NC,estimate_Z10,estimate_Z30,estimate_Z50,names=c("Lasso(CV)","Lasso(VL)","Lasso(BCH)","Optimal Covariate","One Covariate","No Covariates","10 Covariates","30 Covariates","50 Covariates"),main="Boxplots of Estimators")
abline(h=tau)
dev.new()
par(las=1)
boxplot(estimate_LMS_CV,estimate_LMS_LV,estimate_LMS_BCH,estimate_BC,estimate_TC,estimate_NC,estimate_Z10,estimate_Z30,estimate_Z50,names=c("Lasso(CV)","Lasso(VL)","Lasso(BCH)","Optimal Covariate","One Covariate","No Covariates","10 Covariates","30 Covariates","50 Covariates"),main="Boxplots of Estimators")
abline(h=tau)
dev.new()
par(las=1)
boxplot(estimate_LMS_CV,estimate_LMS_LV,estimate_LMS_BCH,estimate_BC,estimate_TC,estimate_NC,estimate_Z10,estimate_Z30,estimate_Z50,names=c("Lasso(CV)","Lasso(VL)","Lasso(BCH)","Optimal\nCovariate","One Covariate","No Covariates","10 Covariates","30 Covariates","50 Covariates"),main="Boxplots of Estimators")
abline(h=tau)
dev.new()
par(las=1)
boxplot(estimate_LMS_CV,estimate_LMS_LV,estimate_LMS_BCH,estimate_BC,estimate_TC,estimate_NC,estimate_Z10,estimate_Z30,estimate_Z50,names=c("Lasso(CV)","Lasso(VL)","Lasso(BCH)","\nOptimal\nCovariate","One Covariate","No Covariates","10 Covariates","30 Covariates","50 Covariates"),main="Boxplots of Estimators")
abline(h=tau)
dev.new()
par(las=1)
boxplot(estimate_LMS_CV,estimate_LMS_LV,estimate_LMS_BCH,estimate_BC,estimate_TC,estimate_NC,estimate_Z10,estimate_Z30,estimate_Z50,names=c("Lasso(CV)","Lasso(VL)","Lasso(BCH)"," \nOptimal\nCovariate","One Covariate","No Covariates","10 Covariates","30 Covariates","50 Covariates"),main="Boxplots of Estimators")
abline(h=tau)
## Selected Covariates
cat("CV chooses on Average ",mean(npars_LMS_CV)," (",sd(npars_LMS_CV),") many covariates.\n")
cat("LV chooses on Average ",mean(npars_LMS_LV)," (",sd(npars_LMS_LV),") many covariates.\n")
cat("BCH chooses on Average ",mean(npars_LMS_BCH)," (",sd(npars_LMS_BCH),") many covariates.\n")
setwd("C:/Users/MAST/Uni/Artikel/RD mit LASSO/R/Package")
library(dectools)
library(devtools)
install.packages("roxygen2")
library(roxygen2)
create("HighDimRD")
install.packages("usethis")
usethis::use_package("rdrobust")
setwd("C:/Users/MAST/Uni/Artikel/RD mit LASSO/R/Package/HighDimRD")
usethis::use_package("rdrobust")
usethis::use_package("glmnet")
?rdrobust
.libPaths()
